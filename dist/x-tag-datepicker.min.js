!function(){function a(a){return JSON.parse(JSON.stringify(a))}function b(a){var b;return 0===a.getUTCHours()?b=new Date(a.valueOf()):(b=new Date,b.setUTCHours(0),b.setUTCFullYear(a.getFullYear()),b.setUTCMonth(a.getMonth()),b.setUTCDate(a.getDate())),b.setUTCMinutes(0),b.setUTCSeconds(0),b.setUTCMilliseconds(0),b}function c(a){return a instanceof Date&&!!a.getTime&&!isNaN(a.getTime())}function d(a){return a.getUTCFullYear()}function e(a){return a.getUTCMonth()}function f(a){return a.getUTCDate()}function g(a,b){var c=a.toString(),d=new Array(b).join("0");return(d+c).substr(-b)}function h(a){return[g(d(a),4),g(e(a)+1,2),g(f(a),2)].join("-")}function i(a){if(c(a))return a;var d=q.exec(a);return d?b(new Date(d[1],d[2]-1,d[3])):null}function j(a){if(c(a))return a;var d=i(a);if(d)return d;var e=Date.parse(a);return isNaN(e)?null:b(new Date(e))}function k(a){var b=a.polyfill?a.xtag.polyfillInput:a.xtag.dateInput,c=j(b.value);return c?a.removeAttribute("invalid"):a.setAttribute("invalid",!0),!!c}function l(a,b){var c=a.polyfill?a.xtag.polyfillInput:a.xtag.dateInput,d=c.value,e=j(d);a.value=b&&e?e:d}function m(a,b,c){var d=a.submitValue,e=a.value;b();var f=a.submitValue,g=a.value;(d!==f||c&&e!==g)&&xtag.fireEvent(a,"change")}function n(a){var b=a.xtag._labels;return new Array(5).join(b.yearAbbr)+"-"+new Array(3).join(b.monthAbbr)+"-"+new Array(3).join(b.dayAbbr)}var o=13,p=document.createElement("x-calendar").labels,q=/(\d{4})[^\d]?(\d{2})[^\d]?(\d{2})/;xtag.register("x-datepicker",{lifecycle:{created:function(){this.innerHTML="";var b=document.createElement("input");b.setAttribute("type","date"),xtag.addClass(b,"x-datepicker-input"),this.appendChild(b),this.xtag.dateInput=b,this.xtag._labels={yearAbbr:"Y",monthAbbr:"M",dayAbbr:"D"},this.xtag._polyfillCalLabels=a(p),this.xtag.polyfillInput=null,this.xtag.polyfillUI=null,this.polyfill=this.hasAttribute("polyfill")||"date"!==b.type.toLowerCase()}},events:{"datetoggleon:delegate(x-calendar)":function(a){var b=a.currentTarget;if(a.detail&&a.detail.date){var c=j(a.detail.date);m(b,function(){b.value=c?h(c):"",xtag.fireEvent(b,"input")})}},"datetoggleoff:delegate(x-calendar)":function(a){a.currentTarget.value=null},focus:function(a){a.currentTarget.setAttribute("focused",!0)},"blur:delegate(.x-datepicker-input)":function(a){a.currentTarget.removeAttribute("focused")},"blur:delegate(.x-datepicker-polyfill-input)":function(a){var b=a.currentTarget;b.removeAttribute("focused"),m(b,function(){l(b,!0)},!0)},"touchstart:delegate(.x-datepicker-polyfill-input)":function(){this.setAttribute("readonly",!0)},"tapstart:delegate(x-calendar)":function(a){a.preventDefault(),a.baseEvent&&a.baseEvent.preventDefault()},"keypress:delegate(.x-datepicker-polyfill-input)":function(a){var b=a.keyCode,c=a.currentTarget;b===o&&m(c,function(){l(c,!0)},!0)},"input:delegate(.x-datepicker-input)":function(a){var b=a.currentTarget;m(b,function(){l(b,!0),a.stopPropagation(),xtag.fireEvent(b,"input")})},"input:delegate(.x-datepicker-polyfill-input)":function(a){var b=a.currentTarget;m(b,function(){l(b,!1),a.stopPropagation(),xtag.fireEvent(b,"input")})},"change:delegate(.x-datepicker-input)":function(a){a.stopPropagation(),xtag.fireEvent(a.currentTarget,"change")},"change:delegate(.x-datepicker-polyfill-input)":function(a){a.stopPropagation();var b=a.currentTarget;m(b,function(){l(b,!1)})}},accessors:{name:{attribute:{selector:".x-datepicker-input"},set:function(a){var b=this.xtag.dateInput;null===a||void 0===a?b.removeAttribute("name"):b.setAttribute("name",a)}},submitValue:{get:function(){return this.xtag.dateInput.value}},value:{attribute:{skip:!0},get:function(){return this.polyfill?this.xtag.polyfillInput.value:this.xtag.dateInput.value},set:function(a){var b=j(a),c=b?h(b):null,d=this.xtag.dateInput,e=this.xtag.polyfillInput,f=this.xtag.polyfillUI;if(null===a||void 0===a)this.removeAttribute("value"),d.value="",e&&(e.value=""),f&&(f.chosen=null);else{var g,i=c?c:a;e?a!==e.value?(e.value=i,g=i):g=a:g=i,this.setAttribute("value",g),c?(d.value=c,f&&(f.chosen=b,f.view=b)):(d.value="",f&&(f.chosen=null))}k(this)}},polyfill:{attribute:{"boolean":!0},set:function(a){var b=this.xtag.dateInput;if(a){if(b.setAttribute("type","hidden"),b.setAttribute("readonly",!0),!this.xtag.polyfillInput){var c=document.createElement("input");xtag.addClass(c,"x-datepicker-polyfill-input"),c.setAttribute("type","text"),c.setAttribute("placeholder",n(this)),c.value=this.xtag.dateInput.value,this.xtag.polyfillInput=c,this.appendChild(c)}if(this.xtag.polyfillInput.removeAttribute("disabled"),!this.xtag.polyfillUI){var d=document.createElement("x-calendar");xtag.addClass(d,"x-datepicker-polyfill-ui"),d.chosen=this.value,d.view=this.xtag.dateInput.value,d.controls=!0,d.labels=this.xtag._polyfillCalLabels,this.xtag.polyfillUI=d,this.appendChild(d)}}else{"date"!==b.getAttribute("type")&&b.setAttribute("type","date"),b.removeAttribute("readonly");var e=this.xtag.polyfillInput;e&&e.setAttribute("disabled",!0)}}},labels:{get:function(){var b={},c=this.xtag._labels,d=this.xtag._polyfillCalLabels;for(var e in c)b[e]=c[e];for(e in d)b[e]=d[e];return a(b)},set:function(a){var b=this.xtag.polyfillUI,c=this.xtag.polyfillInput,d=null;if(b)b.labels=a,this.xtag._polyfillCalLabels=b.labels;else{var e=this.xtag._polyfillCalLabels;for(d in e)d in a&&(e[d]=a[d])}var f=this.xtag._labels;for(d in f)d in a&&(f[d]=a[d]);c&&c.setAttribute("placeholder",n(this))}}}})}();